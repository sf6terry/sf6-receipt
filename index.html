<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒˆ6 è‡ªå·±åˆ†æãƒ¬ã‚·ãƒ¼ãƒˆ å…¨ã‚­ãƒ£ãƒ©å¯¾å¿œç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'DotGothic16', sans-serif; background-color: #222; color: #333; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        h1 { color: #fff; margin-bottom: 5px; text-align: center; font-size: 24px; letter-spacing: 2px; }
        p.desc { color: #aaa; font-size: 12px; margin-bottom: 20px; text-align: center; }
        .container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; max-width: 1200px; width: 100%; }
        .input-area { background: #fff; padding: 20px; border-radius: 8px; width: 320px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border-top: 5px solid #333; margin-bottom: 20px; }
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 12px; margin-bottom: 4px; color: #555; font-weight: bold;}
        input[type="text"], select, textarea { width: 100%; box-sizing: border-box; padding: 8px; background: #f4f4f4; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; font-family: 'DotGothic16'; }
        input[type="range"] { width: 100%; accent-color: #333; cursor: pointer; }
        .range-val { float: right; font-weight: bold; }
        button { width: 100%; padding: 15px; background: #333; color: #fff; border: none; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 16px; border-radius: 4px; font-family: 'DotGothic16'; }
        canvas { width: 100%; max-width: 420px; height: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5); background: #fff; transform: rotate(-1.2deg); margin-bottom: 50px; }
    </style>
</head>
<body>
    <h1>#ã‚¹ãƒˆ6è‡ªå·±åˆ†æãƒ¬ã‚·ãƒ¼ãƒˆ</h1>
    <p class="desc">å…¨ã‚­ãƒ£ãƒ©å¯¾å¿œï¼ˆYear3 C.ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼ã¾ã§ï¼‰</p>
    
    <div class="container">
        <div class="input-area">
            <div class="input-group"><label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label><input type="text" id="pName" value="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼" oninput="draw()"></div>
            <div class="input-group" style="background:#f8f8f8; padding:8px; border-radius:5px;"><label>ğŸ“· ç”»åƒå¤‰æ›´ (è‡ªã‚­ãƒ£ãƒ©ç”»åƒã‚’å„ªå…ˆ)</label><input type="file" id="imageInput" accept="image/*"></div>
            <div class="input-group">
                <label>ä½¿ç”¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</label>
                <select id="pCharSelect" onchange="loadCharImage()">
                    <optgroup label="Year 3 (äºˆå®šå«ã‚€)">
                        <option value="sagat">ã‚µã‚¬ãƒƒãƒˆ</option>
                        <option value="viper">C.ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼</option>
                    </optgroup>
                    <optgroup label="Year 2">
                        <option value="terry" selected>ãƒ†ãƒªãƒ¼</option>
                        <option value="mai">ä¸çŸ¥ç«èˆ</option>
                        <option value="bison">ãƒ™ã‚¬</option>
                        <option value="elena">ã‚¨ãƒ¬ãƒŠ</option>
                    </optgroup>
                    <optgroup label="Year 1">
                        <option value="akuma">è±ªé¬¼</option>
                        <option value="ed">ã‚¨ãƒ‰</option>
                        <option value="aki">A.K.I.</option>
                        <option value="rashid">ãƒ©ã‚·ãƒ¼ãƒ‰</option>
                    </optgroup>
                    <optgroup label="åˆæœŸã‚­ãƒ£ãƒ©">
                        <option value="luke">ãƒ«ãƒ¼ã‚¯</option>
                        <option value="jamie">ã‚¸ã‚§ã‚¤ãƒŸãƒ¼</option>
                        <option value="manon">ãƒãƒãƒ³</option>
                        <option value="kimberly">ã‚­ãƒ³ãƒãƒªãƒ¼</option>
                        <option value="marisa">ãƒãƒªãƒ¼ã‚¶</option>
                        <option value="lily">ãƒªãƒªãƒ¼</option>
                        <option value="jp">JP</option>
                        <option value="juri">ã‚¸ãƒ¥ãƒª</option>
                        <option value="deejay">ãƒ‡ã‚£ãƒ¼ã‚¸ã‚§ã‚¤</option>
                        <option value="cammy">ã‚­ãƒ£ãƒŸã‚£</option>
                        <option value="ryu">ãƒªãƒ¥ã‚¦</option>
                        <option value="ken">ã‚±ãƒ³</option>
                        <option value="chunli">æ˜¥éº—</option>
                        <option value="guile">ã‚¬ã‚¤ãƒ«</option>
                        <option value="blanka">ãƒ–ãƒ©ãƒ³ã‚«</option>
                        <option value="dhalsim">ãƒ€ãƒ«ã‚·ãƒ </option>
                        <option value="honda">E.æœ¬ç”°</option>
                        <option value="zangief">ã‚¶ãƒ³ã‚®ã‚¨ãƒ•</option>
                    </optgroup>
                </select>
            </div>
            <div class="input-group"><label>ãƒ©ãƒ³ã‚¯ãƒ»MR</label><input type="text" id="pRank" value="MASTER MR1700" oninput="draw()"></div>
            <hr>
            <div class="input-group"><label>ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆåå¿œ(è€ã„) <span class="range-val" id="val1">2</span></label><input type="range" id="stat1" min="1" max="5" value="2" oninput="updateVal(1)"></div>
            <div class="input-group"><label>å¯¾ç©ºç²¾åº¦ <span class="range-val" id="val2">3</span></label><input type="range" id="stat2" min="1" max="5" value="3" oninput="updateVal(2)"></div>
            <div class="input-group"><label>ã‚³ãƒ³ãƒœç²¾åº¦ <span class="range-val" id="val3">4</span></label><input type="range" id="stat3" min="1" max="5" value="4" oninput="updateVal(3)"></div>
            <div class="input-group"><label>çŸ¥è­˜ (ãƒ•ãƒ¬ãƒ¼ãƒ ) <span class="range-val" id="val4">5</span></label><input type="range" id="stat4" min="1" max="5" value="5" oninput="updateVal(4)"></div>
            <div class="input-group"><label>ãƒ¡ãƒ³ã‚¿ãƒ« <span class="range-val" id="val5">3</span></label><input type="range" id="stat5" min="1" max="5" value="3" oninput="updateVal(5)"></div>
            <hr>
            <div class="input-group"><label>ãŠã˜ã®ç‹¬ã‚Šè¨€ (Memo)</label><textarea id="pComment" rows="4" oninput="draw()">åå¿œã¯åœ¨åº«åˆ‡ã‚Œã€‚
ã§ã‚‚èª­ã¿ã®é‹­ã•ã ã‘ã§ç”Ÿãã¦ã‚‹ã€‚
ãƒ‘ãƒƒãƒ‰MR1800å¾©å¸°ã¸ï¼</textarea></div>
            <button onclick="downloadImage()">ãƒ¬ã‚·ãƒ¼ãƒˆç™ºè¡Œ (ä¿å­˜)</button>
        </div>
        <div class="preview-area"><canvas id="cardCanvas" width="420"></canvas></div>
    </div>

    <script>
        const canvas = document.getElementById('cardCanvas');
        const ctx = canvas.getContext('2d');
        let currentCharImage = new Image();
        let uploadedImage = null;
        const proxy = "https://images.weserv.nl/?url=";
        
        // å…¨ã‚­ãƒ£ãƒ©å¯¾å¿œç”»åƒãƒªã‚¹ãƒˆ
        const charImageUrls = {
            // Year 2 & 3
            'terry': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1947.jpg',
            'mai': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1952-3.jpg',
            'bison': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-17.jpg',
            'elena': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1980.jpg',
            'sagat': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-14.jpg',
            'viper': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-15.jpg',
            // Year 1
            'rashid': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-12.jpg',
            'aki': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-13.jpg',
            'ed': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1952.jpg',
            'akuma': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-16.jpg',
            // Initial
            'luke': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-6.jpg',
            'jamie': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-9.jpg',
            'manon': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-10.jpg',
            'kimberly': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-8.jpg',
            'marisa': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-7.jpg',
            'lily': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1952-2.jpg',
            'jp': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-11.jpg',
            'juri': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-5.jpg',
            'deejay': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1952-1.jpg',
            'cammy': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-4-1.jpg',
            'ryu': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-1.jpg',
            'honda': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-4.jpg',
            'blanka': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-1-2.jpg',
            'guile': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-2.jpg',
            'ken': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-3.jpg',
            'chunli': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-1-1.jpg',
            'zangief': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-2-1.jpg',
            'dhalsim': 'worldterrysf6log.wordpress.com/wp-content/uploads/2026/02/img_1954-3-1.jpg'
        };

        function updateVal(id) { document.getElementById('val'+id).innerText = document.getElementById('stat'+id).value; draw(); }

        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    uploadedImage = new Image();
                    uploadedImage.onload = function() { draw(); };
                    uploadedImage.src = ev.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

        function loadCharImage() {
            if (!uploadedImage) {
                const charKey = document.getElementById('pCharSelect').value;
                const url = proxy + (charImageUrls[charKey] || charImageUrls['ryu']);
                currentCharImage = new Image();
                currentCharImage.crossOrigin = "anonymous";
                currentCharImage.onload = function() { draw(); };
                currentCharImage.src = url;
                setTimeout(draw, 500);
            }
        }

        function draw() {
            const receiptHeight = 750;
            canvas.height = receiptHeight; 

            // èƒŒæ™¯ã¨ãƒã‚¤ã‚º
            ctx.fillStyle = '#fcfcfc'; ctx.fillRect(0, 0, 420, receiptHeight);
            ctx.fillStyle = "rgba(0,0,0,0.02)";
            for(let i=0; i<420; i+=4) for(let j=0; j<receiptHeight; j+=4) if(Math.random()>0.5) ctx.fillRect(i,j,2,2);

            let y = 35;
            ctx.fillStyle = "#333"; ctx.font = "bold 26px 'VT323'"; ctx.textAlign = "center";
            ctx.fillText("SF6 BATTLE LOG", 210, y);
            y += 22;
            ctx.font = "11px 'DotGothic16'"; ctx.fillText(new Date().toLocaleString(), 210, y);
            y += 12; ctx.fillText("------------------------------------------", 210, y);

            y += 25; ctx.textAlign = "left"; ctx.font = "bold 14px 'DotGothic16'";
            ctx.fillText("PLAYER: " + document.getElementById('pName').value, 45, y);
            y += 20; ctx.fillText("RANK  : " + document.getElementById('pRank').value, 45, y);

            y += 10;
            let img = uploadedImage || currentCharImage;
            const imgSize = 170; 
            if (img.complete && img.naturalWidth !== 0) {
                ctx.save(); ctx.filter = 'grayscale(100%) contrast(150%) brightness(110%)';
                ctx.drawImage(img, (420 - imgSize) / 2, y, imgSize, imgSize); ctx.restore();
            }
            y += imgSize + 10;
            ctx.textAlign = "center"; ctx.fillText("------------------------------------------", 210, y);

            y += 95; 
            const centerX = 210, centerY = y, radius = 65, angleStep = (Math.PI * 2) / 5;
            const stats = [1,2,3,4,5].map(i => parseInt(document.getElementById('stat'+i).value));
            const labels = ["ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ", "å¯¾ç©º", "ã‚³ãƒ³ãƒœ", "çŸ¥è­˜", "ãƒ¡ãƒ³ã‚¿ãƒ«"];

            ctx.strokeStyle = "#ccc"; ctx.lineWidth = 1;
            for (let j = 1; j <= 5; j++) {
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const r = (radius / 5) * j;
                    ctx.lineTo(centerX + r * Math.sin(i * angleStep), centerY - r * Math.cos(i * angleStep));
                }
                ctx.closePath(); ctx.stroke();
            }
            ctx.beginPath(); ctx.fillStyle = "rgba(0,0,0,0.12)"; ctx.strokeStyle = "#333"; ctx.lineWidth = 2.5;
            stats.forEach((val, i) => {
                const r = (radius / 5) * val;
                ctx.lineTo(centerX + r * Math.sin(i * angleStep), centerY - r * Math.cos(i * angleStep));
            });
            ctx.closePath(); ctx.fill(); ctx.stroke();
            ctx.fillStyle = "#333"; ctx.font = "bold 11px 'DotGothic16'";
            labels.forEach((l, i) => {
                const r = radius + 18;
                ctx.fillText(l, centerX + r * Math.sin(i * angleStep), centerY - r * Math.cos(i * angleStep) + 4);
            });

            // 5. ãŠã˜åº¦ (é…ç½®èª¿æ•´æ¸ˆã¿)
            y += radius + 55; 
            const totalScore = stats.reduce((s, v) => s + v, 0);
            // é€†è»¢ãƒ­ã‚¸ãƒƒã‚¯ï¼šä½ã„ã»ã©é«˜%
            const ojiPercent = Math.min(100, Math.max(0, Math.floor(((25 - totalScore) / 20) * 100)));
            
            ctx.textAlign = "left"; ctx.font = "bold 18px 'DotGothic16'"; ctx.fillText("ãŠã˜åº¦", 130, y);
            ctx.textAlign = "right"; ctx.font = "bold 22px 'VT323'"; ctx.fillText(ojiPercent + " %", 290, y);
            
            y += 28;
            let rankStr = totalScore <= 8 ? "ã€å®Œç†ŸãŠã˜ï¼ˆçµ¶æ»…å±æƒ§ç¨®ï¼‰ã€‘" : totalScore <= 14 ? "ã€ä»•ä¸ŠãŒã£ãŸãŠã˜ï¼ˆç¾å½¹ï¼‰ã€‘" : totalScore <= 20 ? "ã€ãŠã˜äºˆå‚™è»ï¼ˆä¸­å …ï¼‰ã€‘" : "ã€ãƒ¤ãƒ³ã‚°ï¼ˆæ ¼ã‚²ãƒ¼æ˜Ÿäººï¼‰ã€‘";
            ctx.textAlign = "center"; ctx.font = "bold 16px 'DotGothic16'"; ctx.fillText(rankStr, 210, y);

            // 6. ç‹¬ã‚Šè¨€ (å‚ç›´ã‚»ãƒ³ã‚¿ãƒ¼é…ç½®)
            const commentLines = document.getElementById('pComment').value.split('\n');
            const footerStart = receiptHeight - 70;
            const gapStart = y + 5; 
            const lineHeight = 22;
            const totalTextHeight = commentLines.length * lineHeight;
            
            y = gapStart + (footerStart - gapStart - totalTextHeight) / 2 + 10;

            ctx.textAlign = "left"; ctx.font = "bold 15px 'DotGothic16'";
            commentLines.forEach(line => { 
                ctx.fillText(line, 45, y); 
                y += lineHeight; 
            });

            // 7. ãƒ•ãƒƒã‚¿ãƒ¼
            y = receiptHeight - 70;
            ctx.fillStyle = "#333";
            for(let i=45; i<375; i+= Math.random()*5+2) ctx.fillRect(i, y, Math.random()*3+1, 30);
            ctx.textAlign = "center"; ctx.font = "11px 'VT323'"; ctx.fillText("THANK YOU FOR PLAYING!", 210, y + 40);
            for(let i=0; i<420; i+=10) { 
                ctx.beginPath(); ctx.moveTo(i, receiptHeight); 
                ctx.lineTo(i+5, receiptHeight-8); ctx.lineTo(i+10, receiptHeight); ctx.fill(); 
            }
        }

        function downloadImage() {
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'sf6_receipt_full.png';
                a.click();
                setTimeout(() => window.open(url, '_blank'), 500);
            });
        }
        window.onload = loadCharImage;
        document.fonts.ready.then(draw);
    </script>
</body>
</html>
